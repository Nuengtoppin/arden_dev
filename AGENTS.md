# AGENTS.md — инструкции для Codex/агентов

## Цель репозитория
Arden — модульный Bevy-проект с фокусом на: сетках (сектора/чанки/окточанки/субчанки), удобном дебаг-UI, и чистой архитектуре. Все изменения должны оставаться совместимыми с **Bevy 0.13.2** и **bevy_egui 0.26.0**.

## Версии и сборка
- Rust: stable (актуальная)
- Bevy: `0.13.2`
- bevy_egui: `0.26.0`

### Команды
- Запуск: `cargo run`
- Release: `cargo build --release`
- Формат: `cargo fmt --all`
- Линт: `cargo clippy --all-targets --all-features -- -D warnings`

## Архитектура (дерево)

/src
├─ main.rs
├─ engine/
│ ├─ app.rs # подключение модулей/плагинов
│ ├─ time.rs # тики/тайминг (задел)
│ └─ config.rs # размеры, скорости, флаги
│
├─ world/
│ ├─ sectors/
│ │ ├─ mod.rs # слои/ID/активный сектор, отрисовка рамок
│ │ └─ render.rs # вспомогательная отрисовка (если вынесено)
│ ├─ chunks/
│ │ ├─ mod.rs
│ │ ├─ octo/ # окточанки 64×64×64 vox
│ │ └─ cube/ # обычные чанки (инфраструктура)
│ ├─ grid/ # визуализатор сеток (чанк/окто/саб/сектор)
│ │ └─ mod.rs
│ ├─ coords.rs # адресация и конверсии (x|z|y)
│ ├─ voxels.rs # описание вокселя (задел)
│ └─ lod.rs # задел под LOD/SVO/DTO
│
├─ gameplay/
│ ├─ player.rs # ввод/ходьба/бег/прыжок
│ └─ camera.rs # камера, захват курсора, колесо
│
├─ render/
│ ├─ pipeline.rs # задел под пайплайн
│ ├─ materials.rs # материалы/цвета
│ └─ debug_draw.rs # вспомогательная отрисовка
│
├─ debug/
│ ├─ mod.rs
│ ├─ ui.rs # левая панель (Tab), правый верх (F3)
│ ├─ input.rs # биндинги F2 / Shift+F2 / Shift+F / '/'
│ └─ stats.rs # FPS, probe-окно, буфер
│
└─ utils/
├─ math.rs
├─ ids.rs
├─ ring_buffer.rs # кольцевой буфер для probe
└─ profiling.rs


## Константы и инварианты мира
- 1 единица = **1 воксель**.
- **Subchunk** = 32×32×32 vox.
- **Octochunk** = 64×64×64 vox.
- **Сектор** = 64×64×16 **окточанков**.
- Слои секторов: нижний `layer=0`, верхний `layer=1`.
- Порядок координат в текстах/гридах: **x | z | y**.
- Камера спавнится в центре верхнего слоя.

## Горячие клавиши (UX)
- `Tab` — показать/спрятать левую панель Egui (“Инструменты / Вектор / Воксель / Оптимизация / PFO”).
- `F2` — цикл сетки: OFF → CHUNK → CHUNK+OCTO → CHUNK+OCTO+SUB.
- `Shift+F2` — показать/спрятать рамки **секторов** (обеих слоёв).
- `F3` — правый верх: FPS, XYZ, грид-координаты (x|z|y), мини-probe.
- `WASD` — движение; `Shift+WASD` — ускорение (×2); `Space` — вверх; `Ctrl` — вниз.
- Колесо мыши — зум; СКМ — навигация без скрытия курсора.
- `Shift+F` — скрыть курсор, включить белую прицельную точку (≈30% альфа).
- `'/'` — внизу однострочная консоль (заглушка).

## Визуал сеток
- **Сектора**: тонкие белые каркасы для верх/низ.
- **Окточанки**: **голубые** линии.
- **Субчанки**: **пунктир/штрих** образца `+– – – + – – – +` по граням.
- Лёгкое радиальное затухание линий к центру, чтобы не рябило.

## Комбо-логика отображения
| Shift+F2 (секторы) | F2 режим | Что видно                         |
|---|---|---|
| Off | 0 | Ничего кроме сцены |
| On  | 0 | Сектора |
| Off | 1 | Чанк |
| On  | 1 | Сектора + Чанк |
| Off | 2 | Чанк + Окто |
| On  | 2 | Сектора + Чанк + Окто |
| Off | 3 | Чанк + Окто + Саб |
| On  | 3 | Сектора + Чанк + Окто + Саб |

## Правила для агентов
- Держать совместимость с Bevy 0.13.2 / bevy_egui 0.26.0.
- Новые фичи — через отдельные модули, без засорения `main.rs`.
- Не ломать хоткеи и инварианты размеров.
- Перед PR: `cargo fmt`, `cargo clippy -D warnings`, локальный `cargo run`.

## Очередь задач (пример)
- [ ] Отладить адресацию: world→sector→chunk→octo→sub (x|z|y).
- [ ] Добавить подписи ID активных уровней в правом верхнем углу.
- [ ] Вынести цвета/толщины линий в `render/materials.rs`.
- [ ] Добавить property-тесты для модуля поворотов `world/rotation`.
- [ ] Подготовить API для выборочного скрытия нижнего слоя сектора.

